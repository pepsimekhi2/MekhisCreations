<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Analytics - Mekhis Creations</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --blue: #3b82f6;
            --blue-dark: #2563eb;
            --blue-glow: rgba(59, 130, 246, 0.4);
            --bg: #07090f;
            --card: rgba(59, 130, 246, 0.07);
            --card-border: rgba(59, 130, 246, 0.18);
            --text: #e8eaf0;
            --text-muted: rgba(232, 234, 240, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(59,130,246,0.04) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59,130,246,0.04) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: 0;
            pointer-events: none;
        }

        body::after {
            content: '';
            position: fixed;
            top: -200px;
            left: -200px;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(59,130,246,0.10) 0%, transparent 70%);
            z-index: 0;
            pointer-events: none;
            animation: orbFloat 8s ease-in-out infinite;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(80px, 60px); }
        }

        header {
            position: relative;
            z-index: 10;
            padding: 28px 48px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--card-border);
            background: rgba(7, 9, 15, 0.85);
            backdrop-filter: blur(20px);
            flex-wrap: wrap;
            gap: 16px;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo-icon {
            width: 46px;
            height: 46px;
            background: var(--blue);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4em;
            box-shadow: 0 0 20px var(--blue-glow);
        }

        h1 {
            font-family: 'Fredoka One', sans-serif;
            font-size: 1.8em;
            color: white;
        }

        .tagline {
            font-size: 0.82em;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-refresh {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(59,130,246,0.15);
            border: 1px solid rgba(59,130,246,0.35);
            border-radius: 10px;
            padding: 10px 20px;
            color: var(--blue);
            font-family: 'Nunito', sans-serif;
            font-size: 0.9em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-refresh:hover {
            background: rgba(59,130,246,0.25);
            border-color: var(--blue);
            transform: translateY(-1px);
        }

        .btn-refresh:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .btn-refresh svg { transition: transform 0.5s ease; }
        .btn-refresh.spinning svg { animation: spinSvg 0.6s linear; }
        @keyframes spinSvg { to { transform: rotate(360deg); } }

        .last-updated {
            font-size: 0.78em;
            color: var(--text-muted);
            white-space: nowrap;
        }

        main {
            position: relative;
            z-index: 5;
            padding: 40px 48px;
            max-width: 1500px;
            margin: 0 auto;
        }

        /* Stats row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 18px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 24px 20px;
            backdrop-filter: blur(10px);
            transition: border-color 0.3s, transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--blue), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover { transform: translateY(-3px); border-color: rgba(59,130,246,0.4); }
        .stat-card:hover::before { opacity: 1; }

        .stat-label {
            font-size: 0.72em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-value {
            font-family: 'Fredoka One', sans-serif;
            font-size: 2.1em;
            color: white;
            line-height: 1;
            margin-bottom: 5px;
        }

        .stat-value.blue  { color: var(--blue); }
        .stat-value.green { color: #10b981; }
        .stat-value.sm    { font-size: 1.3em; margin-top: 6px; }

        .stat-sub { font-size: 0.76em; color: var(--text-muted); }

        /* Card */
        .card {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 32px 36px;
            backdrop-filter: blur(10px);
            margin-bottom: 24px;
        }

        .card-title {
            font-family: 'Fredoka One', sans-serif;
            font-size: 1.35em;
            color: white;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title-icon {
            width: 30px;
            height: 30px;
            background: rgba(59,130,246,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.95em;
        }

        /* Bar list (top 10) */
        .bar-list { display: flex; flex-direction: column; }

        .bar-row {
            display: grid;
            grid-template-columns: 36px 190px 1fr 100px 120px;
            align-items: center;
            gap: 16px;
            padding: 12px 4px;
            border-bottom: 1px solid rgba(59,130,246,0.07);
            transition: background 0.2s;
            border-radius: 8px;
        }

        .bar-row:last-child { border-bottom: none; }
        .bar-row:hover { background: rgba(59,130,246,0.05); }

        .bar-medal {
            font-size: 1.05em;
            text-align: center;
            color: var(--text-muted);
            font-family: 'Fredoka One', sans-serif;
        }

        .rank-1 .bar-medal { color: #ffd700; }
        .rank-2 .bar-medal { color: #c0c0c0; }
        .rank-3 .bar-medal { color: #cd7f32; }

        .bar-name {
            color: white;
            font-weight: 700;
            font-size: 0.92em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bar-track {
            height: 10px;
            background: rgba(59,130,246,0.1);
            border-radius: 5px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.8s ease;
        }

        .bar-count {
            font-family: 'Fredoka One', sans-serif;
            font-size: 1em;
            color: var(--blue);
            text-align: right;
            line-height: 1.3;
        }

        .bar-count small {
            display: block;
            font-family: 'Nunito', sans-serif;
            font-size: 0.65em;
            color: var(--text-muted);
        }

        .bar-value {
            font-size: 0.82em;
            color: #10b981;
            font-weight: 700;
            text-align: right;
        }

        .bar-value.empty-val { color: var(--text-muted); }

        /* Blocks grid */
        .blocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
            gap: 16px;
        }

        .block-card {
            background: rgba(59,130,246,0.06);
            border: 1px solid rgba(59,130,246,0.15);
            border-radius: 14px;
            padding: 20px 18px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .block-card:hover {
            transform: translateY(-4px);
            border-color: rgba(59,130,246,0.35);
            box-shadow: 0 8px 28px rgba(59,130,246,0.12);
        }

        .block-rank {
            position: absolute;
            top: 11px;
            right: 13px;
            font-size: 0.68em;
            color: var(--text-muted);
            font-weight: 700;
            letter-spacing: 1px;
        }

        .block-name {
            font-weight: 700;
            color: white;
            font-size: 0.93em;
            margin-bottom: 10px;
            padding-right: 28px;
            line-height: 1.3;
        }

        .block-count {
            font-family: 'Fredoka One', sans-serif;
            font-size: 2em;
            color: var(--blue);
            line-height: 1;
            margin-bottom: 3px;
        }

        .block-pct {
            font-size: 0.74em;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .block-value-label {
            font-size: 0.68em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }

        .block-value {
            font-family: 'Fredoka One', sans-serif;
            font-size: 1.05em;
            color: #10b981;
            margin-bottom: 12px;
        }

        .block-bar {
            width: 100%;
            height: 5px;
            background: rgba(59,130,246,0.12);
            border-radius: 3px;
            overflow: hidden;
        }

        .block-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.8s ease;
        }

        /* Loading / empty */
        .empty {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-muted);
            grid-column: 1 / -1;
        }

        .spinner {
            width: 34px;
            height: 34px;
            border: 3px solid rgba(59,130,246,0.15);
            border-top-color: var(--blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 1100px) {
            .stats-row { grid-template-columns: repeat(3, 1fr); }
            .bar-row { grid-template-columns: 32px 140px 1fr 80px; }
            .bar-value { display: none; }
        }

        @media (max-width: 700px) {
            header, main { padding: 20px 20px; }
            .stats-row { grid-template-columns: 1fr 1fr; }
            .bar-row { grid-template-columns: 28px 1fr 70px; }
            .bar-track { display: none; }
        }
    </style>
</head>
<body>

<header>
    <div class="logo-area">
        <div class="logo-icon">ğŸ§±</div>
        <div>
            <h1>Block Analytics</h1>
            <div class="tagline">Mekhis Creations Â· Live Stats</div>
        </div>
    </div>

    <div class="header-actions">
        <button class="btn-refresh" id="refreshBtn" onclick="refreshData()">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 4v6h-6"/><path d="M1 20v-6h6"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
            </svg>
            Refresh
        </button>

        <span class="last-updated" id="lastUpdated"></span>
    </div>
</header>

<main>

    <!-- Summary -->
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-label">Total Spawns</div>
            <div class="stat-value" id="totalSpawns">â€”</div>
            <div class="stat-sub">all time</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Total Value</div>
            <div class="stat-value green" id="totalValue">â€”</div>
            <div class="stat-sub">Cash earned</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Unique Blocks</div>
            <div class="stat-value blue" id="uniqueBlocks">â€”</div>
            <div class="stat-sub">block types</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Avg Value / Spawn</div>
            <div class="stat-value" id="avgValue">â€”</div>
            <div class="stat-sub">Cash per block</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Top Block</div>
            <div class="stat-value blue sm" id="topBlockName">â€”</div>
            <div class="stat-sub" id="topBlockSub"></div>
        </div>
    </div>

    <!-- Top 10 bar list -->
    <div class="card">
        <div class="card-title">
            <div class="card-title-icon">ğŸ†</div>
            Top 10 Blocks
        </div>
        <div class="bar-list" id="barList">
            <div style="text-align:center;padding:28px;color:var(--text-muted)">
                <div class="spinner"></div>Loading Firebase dataâ€¦
            </div>
        </div>
    </div>

    <!-- All blocks grid -->
    <div class="card">
        <div class="card-title">
            <div class="card-title-icon">ğŸ“¦</div>
            All Blocks
        </div>
        <div class="blocks-grid" id="blocksGrid">
            <div class="empty"><div class="spinner"></div>Loadingâ€¦</div>
        </div>
    </div>
</main>

<script>
    const FIREBASE_URL = 'https://block-cl-f30cf-default-rtdb.firebaseio.com';

    const COLORS = [
        '#3b82f6','#8b5cf6','#ec4899','#f59e0b','#10b981',
        '#06b6d4','#f97316','#6366f1','#14b8a6','#d946ef',
        '#eab308','#64748b','#0891b2','#7c3aed','#dc2626',
        '#84cc16','#f43f5e','#a78bfa','#34d399','#fb923c'
    ];

    let firebaseData = {};  // { blockName: { count, value } }

    // â”€â”€ Firebase fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchFirebase() {
        const res = await fetch(`${FIREBASE_URL}/blocks.json`);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const raw = await res.json();
        if (!raw) return {};

        const out = {};
        Object.values(raw).forEach(entry => {
            if (!entry || !entry.blockName) return;
            const name = entry.blockName;
            if (!out[name]) out[name] = { count: 0, value: 0 };
            out[name].count += 1;
            out[name].value += (entry.blockValue || 0);
        });
        return out;
    }

    // â”€â”€ CSV parser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Handles both CSV formats:
    //   â€¢ Item, Flow Type, Transaction Type, Transactions, Transaction Amount
    //   â€¢ Item has optional "Value_" prefix
    function parseCSV(text) {
        const lines = text.trim().split(/\r?\n/);
        if (lines.length < 2) return {};

        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
        const itemIdx  = headers.findIndex(h => h === 'item');
        const countIdx = headers.findIndex(h => h === 'transactions');
        const valueIdx = headers.findIndex(h => h === 'transaction amount');

        if (itemIdx === -1) { alert('CSV must have an "Item" column.'); return {}; }

        const out = {};
        for (let i = 1; i < lines.length; i++) {
            const cols = lines[i].split(',').map(c => c.trim());
            if (!cols[itemIdx]) continue;
            const name  = cols[itemIdx].replace(/^Value_/i, '');
            const count = countIdx !== -1 ? (parseInt(cols[countIdx]) || 0) : 0;
            const value = valueIdx !== -1 ? (parseInt(cols[valueIdx]) || 0) : 0;
            if (!out[name]) out[name] = { count: 0, value: 0 };
            out[name].count += count;
            out[name].value += value;
        }
        return out;
    }

    // â”€â”€ Merge sources â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function getMerged() {
        const all = {};
        [firebaseData, csvData].forEach(src => {
            Object.entries(src).forEach(([name, d]) => {
                if (!all[name]) all[name] = { count: 0, value: 0 };
                all[name].count += d.count;
                all[name].value += d.value;
            });
        });
        return all;
    }

    function getActiveData() {
        if (activeSource === 'csv')    return csvData;
        if (activeSource === 'merged') return getMerged();
        return firebaseData;
    }

    // â”€â”€ Source tab switch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function switchSource(src) {
        activeSource = src;
        document.querySelectorAll('.source-tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + src).classList.add('active');
        render();
    }

    // â”€â”€ Manual refresh â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function refreshData() {
        const btn = document.getElementById('refreshBtn');
        btn.classList.add('spinning');
        btn.disabled = true;

        try {
            firebaseData = await fetchFirebase();
            render();
            const t = new Date();
            document.getElementById('lastUpdated').textContent =
                'Updated ' + t.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        } catch (err) {
            console.error(err);
            document.getElementById('barList').innerHTML =
                `<div style="text-align:center;padding:24px;color:#ef4444">âš ï¸ Firebase error: ${err.message}</div>`;
        }

        setTimeout(() => { btn.classList.remove('spinning'); btn.disabled = false; }, 650);
    }

    // â”€â”€ CSV upload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('csvInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = evt => {
            csvData   = parseCSV(evt.target.result);
            csvLoaded = true;
            const count = Object.keys(csvData).length;

            // Badge
            const badge = document.getElementById('csvBadge');
            badge.style.display = 'flex';
            document.getElementById('csvBadgeText').textContent = file.name;

            // Banner
            const banner = document.getElementById('csvBanner');
            banner.classList.add('visible');
            banner.textContent = `ğŸ“„ "${file.name}" loaded â€” ${count} block types found. Use the tabs above to switch between Firebase, CSV, or Merged data.`;

            // Show tabs
            document.getElementById('sourceTabs').classList.add('visible');

            // Auto-switch to merged if firebase data exists, else csv
            switchSource(Object.keys(firebaseData).length ? 'merged' : 'csv');
        };
        reader.readAsText(file);
        // reset so same file can be re-uploaded
        e.target.value = '';
    });

    // â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function render() {
        const data   = getActiveData();
        const sorted = Object.entries(data).sort((a, b) => b[1].count - a[1].count);
        const total  = sorted.reduce((s, [, d]) => s + d.count, 0);
        const totVal = sorted.reduce((s, [, d]) => s + d.value, 0);
        const unique = sorted.length;

        // Summary cards
        animateNum('totalSpawns', total);
        animateNum('totalValue',  totVal, true);
        document.getElementById('uniqueBlocks').textContent = unique || 'â€”';

        const avg = total > 0 ? Math.round(totVal / total) : 0;
        document.getElementById('avgValue').textContent = avg > 0 ? fmt(avg) : 'â€”';

        if (sorted.length) {
            document.getElementById('topBlockName').textContent = sorted[0][0];
            document.getElementById('topBlockSub').textContent  = fmt(sorted[0][1].count) + ' spawns';
        } else {
            document.getElementById('topBlockName').textContent = 'â€”';
            document.getElementById('topBlockSub').textContent  = '';
        }

        renderBarList(sorted, total);
        renderGrid(sorted, total);
    }

    function renderBarList(sorted, total) {
        const top10  = sorted.slice(0, 10);
        const maxCnt = top10[0]?.[1]?.count || 1;
        const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];

        if (!top10.length) {
            document.getElementById('barList').innerHTML =
                '<div style="text-align:center;padding:24px;color:var(--text-muted)">No data available</div>';
            return;
        }

        document.getElementById('barList').innerHTML = top10.map(([name, d], i) => {
            const pct   = total > 0 ? ((d.count / total) * 100).toFixed(1) : '0.0';
            const barW  = ((d.count / maxCnt) * 100).toFixed(1);
            const label = i < 3 ? medals[i] : `#${i+1}`;
            const color = COLORS[i % COLORS.length];
            const valHtml = d.value > 0
                ? `ğŸ’° ${fmt(d.value)}`
                : `<span class="empty-val">â€”</span>`;

            return `<div class="bar-row rank-${i+1}">
                <div class="bar-medal">${label}</div>
                <div class="bar-name" title="${name}">${name}</div>
                <div class="bar-track">
                    <div class="bar-fill" style="width:${barW}%;background:${color}"></div>
                </div>
                <div class="bar-count">${fmt(d.count)}<small>${pct}%</small></div>
                <div class="bar-value">${valHtml}</div>
            </div>`;
        }).join('');
    }

    function renderGrid(sorted, total) {
        if (!sorted.length) {
            document.getElementById('blocksGrid').innerHTML =
                '<div class="empty">No block data found.<br><small>Upload a CSV or check your Firebase connection.</small></div>';
            return;
        }

        const maxCnt = sorted[0][1].count;

        document.getElementById('blocksGrid').innerHTML = sorted.map(([name, d], i) => {
            const pct   = total > 0 ? ((d.count / total) * 100).toFixed(1) : '0.0';
            const barW  = ((d.count / maxCnt) * 100).toFixed(1);
            const color = COLORS[i % COLORS.length];
            const valSection = d.value > 0 ? `
                <div class="block-value-label">Total Value</div>
                <div class="block-value">ğŸ’° ${fmt(d.value)}</div>` : '';

            return `<div class="block-card">
                <div class="block-rank">#${i+1}</div>
                <div class="block-name">${name}</div>
                <div class="block-count">${fmt(d.count)}</div>
                <div class="block-pct">${pct}% of spawns</div>
                ${valSection}
                <div class="block-bar">
                    <div class="block-bar-fill" style="width:${barW}%;background:${color}"></div>
                </div>
            </div>`;
        }).join('');
    }

    // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function fmt(n) {
        if (n >= 1_000_000_000) return (n / 1_000_000_000).toFixed(1).replace(/\.0$/, '') + 'B';
        if (n >= 1_000_000)     return (n / 1_000_000).toFixed(1).replace(/\.0$/, '')     + 'M';
        if (n >= 1_000)         return (n / 1_000).toFixed(1).replace(/\.0$/, '')          + 'K';
        return n.toLocaleString();
    }

    function animateNum(id, target, abbrev = false) {
        const el = document.getElementById(id);
        if (!target) { el.textContent = 'â€”'; return; }
        const steps = 45;
        const inc   = target / steps;
        let cur     = 0;
        const iv    = setInterval(() => {
            cur = Math.min(cur + inc, target);
            el.textContent = abbrev ? fmt(Math.round(cur)) : Math.round(cur).toLocaleString();
            if (cur >= target) clearInterval(iv);
        }, 1000 / steps);
    }

    // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    refreshData();
</script>
</body>
</html>

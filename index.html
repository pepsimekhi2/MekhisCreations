<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BloxNet Onboarding</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #111; color: #fff; }
    #step2 img { border-radius: 50%; }
    input, button { padding: 8px; margin: 5px; }
  </style>
</head>
<body>
  <div id="content"></div>

  <script>
    const LS = localStorage;
    const el = id => document.getElementById(id);
    const randCode = () => Math.floor(10000 + Math.random() * 89999).toString();
    let code = randCode();

    const apiUser = async (id) => {
      const u = await fetch("https://users.roblox.com/v1/users/" + id).then(r => r.json());
      const h = await fetch(`https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${id}&size=150x150&format=Png&isCircular=false`).then(r => r.json());
      return { id: u.id, name: u.name, desc: u.description, headshot: h.data[0].imageUrl };
    };

    const step1 = () => {
      document.getElementById('content').innerHTML = `
        <h2>Welcome to BloxNet!</h2>
        <p>Please enter your Roblox User ID:</p>
        <input id="uid" placeholder="User ID">
        <button onclick="checkUser()">Confirm</button>
      `;
    };

    const checkUser = async () => {
      const id = el("uid").value;
      if (!id) return alert("Enter ID");
      try {
        const u = await apiUser(id);
        window.tmpUser = u;
        document.getElementById('content').innerHTML = `
          <div id="step2">
            <h2>Is this you?</h2>
            <img src="${u.headshot}" width="100"><br>
            <b>${u.name}</b><br>
            <i>${u.desc || "(No description)"}</i><br><br>
            <button onclick="step1()">No</button>
            <button onclick="step3()">Yes</button>
          </div>
        `;
      } catch {
        alert("User not found");
      }
    };

    const step3 = () => {
      code = randCode();
      document.getElementById('content').innerHTML = `
        <h2>Verification</h2>
        <p>Add this code to your Roblox profile description:</p>
        <h1>${code}</h1>
        <button onclick="verify()">Verify</button>
        <button onclick="step3()">Refresh Code</button>
      `;
    };

    const verify = async () => {
      const u = await apiUser(window.tmpUser.id);
      if (u.desc.includes(code)) {
        LS.setItem("newUser", "false");
        LS.setItem("robloxId", u.id);
        LS.setItem("robloxName", u.name);
        LS.setItem("robloxHeadshot", u.headshot);
        document.getElementById('content').innerHTML = `
          <h2>âœ… Verification Complete!</h2>
          <p>Welcome, ${u.name}.</p>
          <img src="${u.headshot}" width="100">
        `;
      } else {
        alert("Code not found in description.");
      }
    };

    // On load
    if (LS.getItem("newUser") === "false") {
      document.getElementById('content').innerHTML = `
        <h2>Welcome back, ${LS.getItem("robloxName")}!</h2>
        <img src="${LS.getItem("robloxHeadshot")}" width="100">
        <p>You're already verified.</p>
      `;
    } else {
      LS.setItem("newUser", "true");
      step1();
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mekhis Creations</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fredoka One', Arial, sans-serif;
            background-color: #0a0a0f;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .floating-member {
            position: fixed;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            pointer-events: none;
            opacity: 0.3;
            z-index: 0;
            animation: floatAnim linear infinite;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            border: 2px solid rgba(59, 130, 246, 0.2);
        }

        @keyframes floatAnim {
            0% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(180deg);
            }
            100% {
                transform: translateY(0) rotate(360deg);
            }
        }

        header {
            background-color: #3b82f6;
            padding: 30px 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: white;
            font-size: 3em;
            margin-bottom: 8px;
        }

        .tagline {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2em;
            font-weight: normal;
        }

        main {
            padding: 40px;
            color: #e0e0e0;
            position: relative;
            z-index: 5;
        }

        .intro-text {
            max-width: 900px;
            margin: 30px auto 50px;
            text-align: center;
            font-size: 1.1em;
            line-height: 1.8;
            color: #e0e0e0;
            padding: 25px 30px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .stats-container {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: stretch;
            margin-top: 50px;
            flex-wrap: wrap;
        }

        .stat-frame {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .stat-frame.small {
            flex: 1;
            max-width: 250px;
            min-width: 200px;
        }

        .stat-frame.large {
            flex: 2;
            max-width: 500px;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .stat-title {
            font-size: 1.2em;
            color: #3b82f6;
            margin-bottom: 20px;
            text-align: center;
        }

        .counter {
            font-size: 4em;
            color: white;
            font-weight: bold;
            text-align: center;
            font-family: 'Fredoka One', Arial, sans-serif;
        }

        .games-section {
            max-width: 1200px;
            margin: 60px auto;
            text-align: center;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 15px;
            padding: 40px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .games-title {
            font-size: 2em;
            color: #3b82f6;
            margin-bottom: 30px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .game-card {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            position: relative;
            pointer-events: none;
        }

        .game-icon {
            width: 100%;
            height: 180px;
            border-radius: 8px;
            object-fit: cover;
            background: #333;
            margin-bottom: 15px;
        }

        .game-name {
            font-size: 1.3em;
            color: white;
            margin-bottom: 8px;
        }

        .game-description {
            font-size: 0.9em;
            color: rgba(224, 224, 224, 0.7);
            margin-bottom: 12px;
            line-height: 1.5;
            min-height: 60px;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(59, 130, 246, 0.2);
        }

        .game-stat {
            flex: 1;
        }

        .game-stat-label {
            font-size: 0.75em;
            color: rgba(224, 224, 224, 0.5);
            margin-bottom: 3px;
        }

        .game-stat-value {
            font-size: 0.95em;
            color: #3b82f6;
            font-weight: bold;
        }

        .group-section {
            max-width: 800px;
            margin: 60px auto;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 15px;
            padding: 40px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .group-header {
            display: flex;
            gap: 25px;
            margin-bottom: 30px;
            align-items: center;
        }

        .group-icon {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            object-fit: cover;
            border: 2px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .group-info {
            flex: 1;
        }

        .group-name {
            font-size: 2em;
            color: white;
            margin-bottom: 10px;
        }

        .group-description {
            font-size: 0.95em;
            color: rgba(224, 224, 224, 0.7);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .group-shout {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .group-shout-label {
            font-size: 0.85em;
            color: #3b82f6;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .group-shout-text {
            color: rgba(224, 224, 224, 0.9);
            font-size: 1em;
            line-height: 1.6;
        }

        .group-owner {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .group-owner-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }

        .group-owner-info {
            flex: 1;
        }

        .group-owner-label {
            font-size: 0.75em;
            color: rgba(224, 224, 224, 0.6);
            margin-bottom: 4px;
        }

        .group-owner-name {
            font-size: 1.1em;
            color: white;
        }

        .group-owner-username {
            font-size: 0.9em;
            color: rgba(224, 224, 224, 0.6);
        }

        .group-join-btn {
            width: 100%;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 12px;
            font-family: 'Fredoka One', Arial, sans-serif;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.4);
        }

        .group-join-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.5);
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        .vision-section {
            max-width: 900px;
            margin: 60px auto;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 15px;
            padding: 40px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .vision-title {
            font-size: 2em;
            color: #3b82f6;
            margin-bottom: 25px;
            text-align: center;
        }

        .vision-content {
            font-size: 1em;
            color: rgba(224, 224, 224, 0.9);
            line-height: 1.8;
            text-align: center;
        }

        .mentions-section {
            max-width: 1000px;
            margin: 60px auto;
            text-align: center;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 15px;
            padding: 40px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .mentions-title {
            font-size: 2em;
            color: #3b82f6;
            margin-bottom: 10px;
        }

        .mentions-subtitle {
            font-size: 0.85em;
            color: rgba(224, 224, 224, 0.7);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .mentions-divider {
            height: 3px;
            background: linear-gradient(to right, transparent, #3b82f6, transparent);
            margin: 25px 0 35px;
        }

        .mentions-grid {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mention-card {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px 30px;
            min-width: 200px;
            transition: all 0.3s ease;
        }

        .mention-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            background: rgba(59, 130, 246, 0.2);
        }

        .mention-name {
            font-size: 1.2em;
            color: white;
            margin-bottom: 5px;
        }

        .mention-handle {
            font-size: 0.9em;
            color: rgba(224, 224, 224, 0.6);
        }

        .loading {
            color: rgba(224, 224, 224, 0.6);
            font-size: 0.9em;
        }

        .wall-section {
            max-width: 1200px;
            margin: 60px auto;
            text-align: center;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 15px;
            padding: 40px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .wall-title {
            font-size: 2em;
            color: #3b82f6;
            margin-bottom: 10px;
        }

        .wall-subtitle {
            font-size: 0.85em;
            color: rgba(224, 224, 224, 0.7);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .wall-add-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-family: 'Fredoka One', Arial, sans-serif;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.4);
            margin-bottom: 30px;
        }

        .wall-add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.5);
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        .wall-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .wall-user {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .wall-user:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            background: rgba(59, 130, 246, 0.2);
        }

        .wall-user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 10px;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }

        .wall-user-name {
            font-size: 1em;
            color: white;
            margin-bottom: 3px;
        }

        .wall-user-username {
            font-size: 0.8em;
            color: rgba(224, 224, 224, 0.6);
            margin-bottom: 8px;
        }

        .wall-user-date {
            font-size: 0.75em;
            color: rgba(224, 224, 224, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }

        .modal-title {
            font-size: 1.5em;
            color: #3b82f6;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            color: white;
            font-family: 'Fredoka One', Arial, sans-serif;
            font-size: 1em;
            margin-bottom: 20px;
        }

        .modal-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .modal-btn {
            width: 100%;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-family: 'Fredoka One', Arial, sans-serif;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .modal-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        .modal-btn.secondary {
            background: rgba(59, 130, 246, 0.2);
        }

        .modal-btn.secondary:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .user-preview {
            text-align: center;
            margin: 20px 0;
        }

        .user-preview-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 15px;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }

        .user-preview-name {
            font-size: 1.3em;
            color: white;
            margin-bottom: 5px;
        }

        .user-preview-username {
            font-size: 0.9em;
            color: rgba(224, 224, 224, 0.6);
        }

        .verification-code {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .verification-code-label {
            font-size: 0.9em;
            color: rgba(224, 224, 224, 0.7);
            margin-bottom: 10px;
        }

        .verification-code-value {
            font-size: 2em;
            color: #3b82f6;
            letter-spacing: 5px;
            margin-bottom: 10px;
        }

        .modal-text {
            color: rgba(224, 224, 224, 0.8);
            font-size: 0.9em;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-btn-group {
            display: flex;
            gap: 10px;
        }

        .modal-btn-group .modal-btn {
            margin-bottom: 0;
        }

        .error-text {
            color: #ff4444;
            font-size: 0.9em;
            margin-top: 10px;
            text-align: center;
        }

        .success-text {
            color: #44ff44;
            font-size: 0.9em;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Mekhis Creations</h1>
            <p class="tagline">We build it, You play it!</p>
        </div>
    </header>

    <main>
        <div class="intro-text">
            Mekhis Creations is a Roblox development studio dedicated to creating games that offer fair opportunities for free-to-play players, without giving pay-to-win advantages. With a growing community and thousands of game visits across our titles, we're rapidly expanding as a passionate development team.
        </div>

        <div class="vision-section">
            <h2 class="vision-title">Our Vision</h2>
            <div class="vision-content">
                Our Vision is to create Roblox games where freeâ€‘toâ€‘play and paying players share the exact same fair ground, so there is never any need to spend money just to be equal to others. In our games, skill, strategy, and effort always matter more than how much Robux someone has, and any paid option is designed as a bonus, not a requirement. Free players will always be able to experience the full game and reach the same power, progression, and content as paying players, even if it takes more time or dedication. Paying for products is only there to offer cosmetics, convenience, and optional shortcuts, never unbeatable power or exclusive advantages that break the balance. Our Vision is to prove that a Roblox game can respect every player, be fair to everyone, and still succeed without becoming payâ€‘toâ€‘win or forcing anyone to open their wallet just to have fun.
            </div>
        </div>

        <div class="stats-container">
            <div class="stat-frame small">
                <div class="stat-title">Total Group Members:</div>
                <div class="counter" id="memberCounter" style="font-size: 3em;">330+</div>
            </div>

            <div class="stat-frame large">
                <div class="stat-title">Total Visits Contributed:</div>
                <div class="counter" id="visitCounter">0</div>
            </div>

            <div class="stat-frame small">
                <div class="stat-title">Published Games:</div>
                <div class="counter" id="gamesCounter" style="font-size: 3em;">3</div>
            </div>
        </div>

        <div class="games-section">
            <h2 class="games-title">Our Games</h2>
            <div class="games-grid" id="gamesGrid"></div>
        </div>

        <div class="group-section" id="groupSection">
            <div class="loading">Loading group information...</div>
        </div>

        <div class="mentions-section">
            <h2 class="mentions-title">Honorable Mentions</h2>
            <p class="mentions-subtitle">
                These individuals have shown incredible dedication to our development and deserve a huge thank you for their contributions.
            </p>
            <div class="mentions-divider"></div>
            <div class="mentions-grid">
                <div class="mention-card">
                    <div class="mention-name">Spadebloke</div>
                    <div class="mention-handle">@Spadebloke</div>
                </div>
                <div class="mention-card">
                    <div class="mention-name">Santi</div>
                    <div class="mention-handle">@im_santi_</div>
                </div>
                <div class="mention-card">
                    <div class="mention-name">Hobee</div>
                    <div class="mention-handle">@doge_800</div>
                </div>
            </div>
        </div>

        <div class="wall-section">
            <h2 class="wall-title">The Wall</h2>
            <p class="wall-subtitle">
                Join our community wall and be part of Mekhis Creations history!
            </p>
            <button class="wall-add-btn" onclick="openWallModal()">Be Added Here</button>
            <div class="wall-grid" id="wallGrid">
                <div class="loading">Loading wall members...</div>
            </div>
        </div>
    </main>

    <div class="modal" id="wallModal">
        <div class="modal-content">
            <div id="modalStep1">
                <h3 class="modal-title">Join The Wall</h3>
                <p class="modal-text">Enter your Roblox User ID to get started</p>
                <input type="text" class="modal-input" id="userIdInput" placeholder="Enter User ID">
                <button class="modal-btn" onclick="findUser()">Find User</button>
                <button class="modal-btn secondary" onclick="closeWallModal()">Cancel</button>
            </div>

            <div id="modalStep2" style="display: none;">
                <h3 class="modal-title">Finding User...</h3>
                <p class="modal-text">Please wait while we locate your profile...</p>
            </div>

            <div id="modalStep3" style="display: none;">
                <h3 class="modal-title">Is This You?</h3>
                <div class="user-preview" id="userPreview"></div>
                <div class="modal-btn-group">
                    <button class="modal-btn" onclick="confirmUser()">Yes, That's Me</button>
                    <button class="modal-btn secondary" onclick="resetModal()">No, Try Again</button>
                </div>
            </div>

            <div id="modalStep4" style="display: none;">
                <h3 class="modal-title">Verify Your Account</h3>
                <p class="modal-text">Copy this code and add it to your Roblox profile description, then click Confirm.</p>
                <div class="verification-code">
                    <div class="verification-code-label">Verification Code</div>
                    <div class="verification-code-value" id="verificationCode"></div>
                    <button class="modal-btn secondary" onclick="copyCode()">Copy Code</button>
                </div>
                <button class="modal-btn" onclick="verifyUser()">Confirm Verification</button>
                <button class="modal-btn secondary" onclick="closeWallModal()">Cancel</button>
                <div id="verifyError"></div>
            </div>

            <div id="modalStep5" style="display: none;">
                <h3 class="modal-title">Success!</h3>
                <p class="success-text" style="font-size: 1.1em;">You've been added to The Wall! ðŸŽ‰</p>
                <button class="modal-btn" onclick="closeWallModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        const GROUP_ID = '33719761';
        const API_BASE_URL = '/api';
        
        let currentUserData = null;
        let verificationCode = null;

        function openWallModal() {
            document.getElementById('wallModal').classList.add('active');
            resetModal();
        }

        function closeWallModal() {
            document.getElementById('wallModal').classList.remove('active');
            resetModal();
        }

        function resetModal() {
            document.getElementById('modalStep1').style.display = 'block';
            document.getElementById('modalStep2').style.display = 'none';
            document.getElementById('modalStep3').style.display = 'none';
            document.getElementById('modalStep4').style.display = 'none';
            document.getElementById('modalStep5').style.display = 'none';
            document.getElementById('userIdInput').value = '';
            currentUserData = null;
            verificationCode = null;
        }

        async function findUser() {
            const userId = document.getElementById('userIdInput').value.trim();
            if (!userId) {
                alert('Please enter a User ID');
                return;
            }

            // Check if already on wall
            try {
                const checkResponse = await fetch(`${API_BASE_URL}/wall.js?method=GET&userId=${userId}`);
                const exists = await checkResponse.json();
                if (exists && exists.userId) {
                    alert('This user is already on The Wall!');
                    return;
                }
            } catch (error) {
                console.error('Error checking wall:', error);
            }

            // Show loading
            document.getElementById('modalStep1').style.display = 'none';
            document.getElementById('modalStep2').style.display = 'block';

            // Fake loading delay
            await new Promise(resolve => setTimeout(resolve, 1500));

            try {
                const response = await fetch(`${API_BASE_URL}/userdata.js?userId=${userId}`);
                if (!response.ok) {
                    throw new Error('User not found');
                }
                
                currentUserData = await response.json();
                
                // Show user preview
                document.getElementById('modalStep2').style.display = 'none';
                document.getElementById('modalStep3').style.display = 'block';
                
                const preview = document.getElementById('userPreview');
                preview.innerHTML = `
                    <img src="${currentUserData.headshot || currentUserData.avatar}" class="user-preview-avatar" alt="${currentUserData.displayName}">
                    <div class="user-preview-name">${currentUserData.displayName}</div>
                    <div class="user-preview-username">@${currentUserData.name}</div>
                `;
            } catch (error) {
                alert('Failed to find user. Please check the User ID and try again.');
                resetModal();
            }
        }

        function confirmUser() {
            // Generate 6-digit verification code
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            
            document.getElementById('modalStep3').style.display = 'none';
            document.getElementById('modalStep4').style.display = 'block';
            document.getElementById('verificationCode').textContent = verificationCode;
        }

        function copyCode() {
            navigator.clipboard.writeText(verificationCode);
            alert('Code copied to clipboard!');
        }

        async function verifyUser() {
            const errorDiv = document.getElementById('verifyError');
            errorDiv.innerHTML = '<div class="loading">Verifying...</div>';

            try {
                // Fetch fresh user data to check description using full URL
                const response = await fetch(`https://www.mekhiscreations.org/api/userdata.js?userId=${currentUserData.id}`);
                if (!response.ok) {
                    throw new Error('Failed to verify');
                }
                
                const freshUserData = await response.json();
                
                // Check if verification code is in description
                if (!freshUserData.description || !freshUserData.description.includes(verificationCode)) {
                    errorDiv.innerHTML = '<div class="error-text">Verification code not found in your description. Please add it and try again.</div>';
                    return;
                }

                // Save to Firebase via API
                const wallData = {
                    userId: currentUserData.id,
                    displayName: currentUserData.displayName,
                    username: currentUserData.name,
                    headshot: currentUserData.headshot,
                    addedAt: new Date().toISOString()
                };

                const firebaseResponse = await fetch(`${API_BASE_URL}/wall.js?method=POST`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(wallData)
                });

                if (!firebaseResponse.ok) {
                    const errorData = await firebaseResponse.json();
                    throw new Error(errorData.error || 'Failed to save to wall');
                }

                // Save to localStorage (permanent)
                localStorage.setItem(`wall_${currentUserData.id}`, JSON.stringify(wallData));

                // Show success
                document.getElementById('modalStep4').style.display = 'none';
                document.getElementById('modalStep5').style.display = 'block';

                // Reload wall
                setTimeout(() => {
                    loadWall();
                }, 1000);

            } catch (error) {
                console.error('Verification error:', error);
                errorDiv.innerHTML = `<div class="error-text">${error.message}</div>`;
            }
        }

        async function loadWall() {
            const wallGrid = document.getElementById('wallGrid');
            wallGrid.innerHTML = '<div class="loading">Loading wall members...</div>';

            try {
                const response = await fetch(`${API_BASE_URL}/wall.js?method=GET`);
                const data = await response.json();

                if (!data || Object.keys(data).length === 0) {
                    wallGrid.innerHTML = '<div class="loading">No members yet. Be the first!</div>';
                    return;
                }

                wallGrid.innerHTML = '';

                // Convert to array and sort by date (newest first)
                const members = Object.values(data).sort((a, b) => 
                    new Date(b.addedAt) - new Date(a.addedAt)
                );

                members.forEach(member => {
                    const memberDiv = document.createElement('div');
                    memberDiv.className = 'wall-user';
                    
                    const timeAdded = timeAgo(member.addedAt);
                    
                    memberDiv.innerHTML = `
                        <img src="${member.headshot}" class="wall-user-avatar" alt="${member.displayName}">
                        <div class="wall-user-name">${member.displayName}</div>
                        <div class="wall-user-username">@${member.username}</div>
                        <div class="wall-user-date">${timeAdded}</div>
                    `;
                    
                    wallGrid.appendChild(memberDiv);
                });
            } catch (error) {
                console.error('Failed to load wall:', error);
                wallGrid.innerHTML = '<div class="loading">Failed to load wall members.</div>';
            }
        }

        function animateMemberCounter(targetCount) {
            const counter = document.getElementById('memberCounter');
            const duration = 2000;
            const increment = duration / 50;
            let current = 0;

            function updateCounter() {
                if (current < targetCount) {
                    current += targetCount / 50;
                    if (current > targetCount) {
                        current = targetCount;
                    }
                    counter.textContent = Math.floor(current).toLocaleString();
                    setTimeout(updateCounter, increment);
                } else {
                    counter.textContent = targetCount.toLocaleString();
                }
            }

            updateCounter();
        }

        function animateVisitCounter(targetCount) {
            const counter = document.getElementById('visitCounter');
            const duration = 3000;
            const increment = duration / 60;
            let current = 0;

            function updateCounter() {
                if (current < targetCount) {
                    current += targetCount / 60;
                    if (current > targetCount) {
                        current = targetCount;
                    }
                    counter.textContent = Math.floor(current).toLocaleString();
                    setTimeout(updateCounter, increment);
                } else {
                    counter.textContent = targetCount.toLocaleString();
                }
            }

            updateCounter();
        }

        function timeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffSeconds = Math.floor(diffMs / 1000);
            const diffMinutes = Math.floor(diffSeconds / 60);
            const diffHours = Math.floor(diffMinutes / 60);
            const diffDays = Math.floor(diffHours / 24);
            const diffMonths = Math.floor(diffDays / 30);
            const diffYears = Math.floor(diffDays / 365);

            if (diffYears > 0) {
                const remainingMonths = Math.floor((diffDays % 365) / 30);
                return remainingMonths > 0 
                    ? `${diffYears} year${diffYears > 1 ? 's' : ''} & ${remainingMonths} month${remainingMonths > 1 ? 's' : ''} ago`
                    : `${diffYears} year${diffYears > 1 ? 's' : ''} ago`;
            } else if (diffMonths > 0) {
                const remainingDays = diffDays % 30;
                return remainingDays > 0 
                    ? `${diffMonths} month${diffMonths > 1 ? 's' : ''} & ${remainingDays} day${remainingDays > 1 ? 's' : ''} ago`
                    : `${diffMonths} month${diffMonths > 1 ? 's' : ''} ago`;
            } else if (diffDays > 0) {
                return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            } else if (diffHours > 0) {
                return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            } else if (diffMinutes > 0) {
                return `${diffMinutes} minute${diffMinutes > 1 ? 's' : ''} ago`;
            } else {
                return 'Just now';
            }
        }

        async function loadGroupData() {
            try {
                const response = await fetch(`${API_BASE_URL}/group.js?groupId=${GROUP_ID}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Group data:', data);
                
                if (data && data.memberCount) {
                    animateMemberCounter(data.memberCount);
                }

                await loadGroupDisplay(data);
            } catch (error) {
                console.error('Group API failed, using default', error);
                document.getElementById('memberCounter').textContent = '330+';
            }
        }

        async function loadGroupDisplay(groupData) {
            const groupSection = document.getElementById('groupSection');
            
            if (!groupData) {
                groupSection.innerHTML = '<div class="loading">Failed to load group information.</div>';
                return;
            }

            let groupIcon = '';
            try {
                const iconResponse = await fetch(
                    `https://thumbnails.roproxy.com/v1/groups/icons?groupIds=${GROUP_ID}&size=150x150&format=Png&isCircular=false`
                );
                if (iconResponse.ok) {
                    const iconData = await iconResponse.json();
                    if (iconData.data && iconData.data.length > 0) {
                        groupIcon = iconData.data[0].imageUrl;
                    }
                }
            } catch (error) {
                console.error('Failed to fetch group icon:', error);
            }

            let ownerAvatar = '';
            if (groupData.owner && groupData.owner.userId) {
                try {
                    const avatarResponse = await fetch(
                        `https://thumbnails.roproxy.com/v1/users/avatar-headshot?userIds=${groupData.owner.userId}&size=150x150&format=Png&isCircular=false`
                    );
                    if (avatarResponse.ok) {
                        const avatarData = await avatarResponse.json();
                        if (avatarData.data && avatarData.data.length > 0) {
                            ownerAvatar = avatarData.data[0].imageUrl;
                        }
                    }
                } catch (error) {
                    console.error('Failed to fetch owner avatar:', error);
                }
            }

            const groupName = groupData.name || 'Mekhis Creations';
            const groupDescription = groupData.description || 'No description available';
            const shoutText = groupData.shout?.body || 'No recent announcements';
            const ownerDisplayName = groupData.owner?.displayName || 'Unknown';
            const ownerUsername = groupData.owner?.username || 'unknown';

            groupSection.innerHTML = `
                <div class="group-header">
                    ${groupIcon ? `<img src="${groupIcon}" alt="${groupName}" class="group-icon">` : ''}
                    <div class="group-info">
                        <div class="group-name">${groupName}</div>
                        <div class="group-description">${groupDescription}</div>
                    </div>
                </div>
                
                ${shoutText !== 'No recent announcements' ? `
                <div class="group-shout">
                    <div class="group-shout-label">Recent Announcement</div>
                    <div class="group-shout-text">${shoutText}</div>
                </div>
                ` : ''}
                
                <div class="group-owner">
                    ${ownerAvatar ? `<img src="${ownerAvatar}" alt="${ownerDisplayName}" class="group-owner-avatar">` : ''}
                    <div class="group-owner-info">
                        <div class="group-owner-label">Group Owner</div>
                        <div class="group-owner-name">${ownerDisplayName}</div>
                        <div class="group-owner-username">@${ownerUsername}</div>
                    </div>
                </div>
                
                <button class="group-join-btn" onclick="window.open('https://www.roblox.com/communities/${GROUP_ID}/Mekhis-Creations#!/about','_blank')">
                    Be Apart of the Community
                </button>
            `;
        }

        async function loadGames() {
            const gamesGrid = document.getElementById('gamesGrid');
            gamesGrid.innerHTML = '<div class="loading">Loading games...</div>';

            try {
                const response = await fetch(
                    `${API_BASE_URL}/games.js?groupId=${GROUP_ID}`
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Games data:', data);
                
                if (!data || !data.data || data.data.length === 0) {
                    gamesGrid.innerHTML = '<div class="loading">No games found.</div>';
                    document.getElementById('gamesCounter').textContent = '0';
                    animateVisitCounter(0);
                    return;
                }

                document.getElementById('gamesCounter').textContent = data.data.length;
                
                const rootPlaceIds = data.data.map(g => g.rootPlaceId).join(',');
                let visitsData = {};
                
                try {
                    const visitsResponse = await fetch(
                        `https://games.roproxy.com/v1/games?universeIds=${data.data.map(g => g.id).join(',')}`
                    );
                    if (visitsResponse.ok) {
                        const visitsJson = await visitsResponse.json();
                        (visitsJson.data || []).forEach(game => {
                            visitsData[game.id] = game.visits || 0;
                        });
                    }
                } catch (visitsError) {
                    console.error('Failed to fetch visits:', visitsError);
                }
                
                let totalVisits = 0;
                for (const game of data.data) {
                    const gameVisits = visitsData[game.id] || 0;
                    totalVisits += gameVisits;
                }
                animateVisitCounter(totalVisits);
                
                const gamesWithVisits = data.data.map(game => ({
                    ...game,
                    visits: visitsData[game.id] || 0
                })).sort((a, b) => b.visits - a.visits);
                
                gamesGrid.innerHTML = '';

                gamesWithVisits.forEach((game) => {
                    const gameCard = document.createElement('div');
                    gameCard.className = 'game-card';
                    
                    const gameIcon = game.icon || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="180" viewBox="0 0 300 180"%3E%3Crect fill="%23333" width="300" height="180"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" fill="%23666" font-family="Arial" font-size="20"%3EGame%3C/text%3E%3C/svg%3E';
                    
                    const description = game.description || 'No description available';
                    const visits = game.visits.toLocaleString();
                    const lastUpdated = game.updated ? timeAgo(game.updated) : 'Recently';
                    
                    gameCard.innerHTML = `
                        <img src="${gameIcon}" 
                             alt="${game.name}" 
                             class="game-icon" 
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22180%22 viewBox=%220 0 300 180%22%3E%3Crect fill=%22%23333%22 width=%22300%22 height=%22180%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23666%22 font-family=%22Arial%22 font-size=%2220%22%3EGame%3C/text%3E%3C/svg%3E'">
                        <div class="game-name">${game.name}</div>
                        <div class="game-description">${description}</div>
                        <div class="game-stats">
                            <div class="game-stat">
                                <div class="game-stat-label">Visits</div>
                                <div class="game-stat-value">${visits}</div>
                            </div>
                            <div class="game-stat">
                                <div class="game-stat-label">Updated</div>
                                <div class="game-stat-value">${lastUpdated}</div>
                            </div>
                        </div>
                    `;
                    gamesGrid.appendChild(gameCard);
                });
            } catch (error) {
                console.error('Games API failed', error);
                gamesGrid.innerHTML = '<div class="loading">Failed to load games.</div>';
                document.getElementById('gamesCounter').textContent = '3';
                animateVisitCounter(25000);
            }
        }

        async function createFloatingMembers() {
            try {
                const response = await fetch(
                    `${API_BASE_URL}/members.js?groupId=${GROUP_ID}`
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Members data:', data);
                
                if (!data || !data.data || data.data.length === 0) {
                    return;
                }

                for (const member of data.data) {
                    if (member.thumbnailUrl) {
                        const img = document.createElement('img');
                        img.src = member.thumbnailUrl;
                        img.className = 'floating-member';
                        img.style.left = Math.random() * (window.innerWidth - 60) + 'px';
                        img.style.top = Math.random() * (window.innerHeight - 60) + 'px';
                        img.style.animationDuration = (8 + Math.random() * 8) + 's';
                        img.style.animationDelay = (Math.random() * 3) + 's';
                        document.body.appendChild(img);
                    }
                }
            } catch (error) {
                console.error('Members API failed:', error);
            }
        }

        window.addEventListener('DOMContentLoaded', async () => {
            await Promise.all([
                loadGroupData(),
                loadGames(),
                createFloatingMembers(),
                loadWall()
            ]);
            
            console.log('All data loaded!');
        });
    </script>
</body>
</html>
